<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatGPT 3.5</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
}

.chat-container {
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
}

.chat-box {
  border: 1px solid #ccc;
  padding: 10px;
  height: 500px;
  overflow-y: scroll;
  margin-bottom: 10px;
}

input[type="text"] {
  width: calc(100% - 80px);
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
  margin-right: 10px;
}

button {
  padding: 10px 20px;
  background-color: #007bff;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

button:hover {
  background-color: #0056b3;
}

#delete-history {
  background-color: #dc3545;
}

#delete-history:hover {
  background-color: #c82333;
}
</style>
</head>
<body>
<div class="chat-container">
    <div id="chat-box" class="chat-box"></div>
    <input type="text" id="user-input" placeholder="è¯¢é—®ChatGPT..."><button onclick="handleSend()">å‘é€</button>
    <button id="delete-history">æ¸…ç©º</button> <!-- åˆ é™¤èŠå¤©è®°å½•æŒ‰é’® -->
</div>
<script>
// å°è¯•ä»localStorageä¸­è¯»å–èŠå¤©è®°å½•æ¥åˆå§‹åŒ–chatHistory
let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];

// é¡µé¢åŠ è½½å®Œæˆåï¼Œç«‹å³æ›´æ–°èŠå¤©æ¡†ä»¥æ˜¾ç¤ºå­˜å‚¨çš„èŠå¤©è®°å½•
document.addEventListener('DOMContentLoaded', () => {
  chatHistory.forEach(item => updateChatBox(item.role, item.content));
});

async function handleSend() {
  const input = document.getElementById('user-input');
  const message = input.value;
  input.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†

  if (message.trim() === '') return; // å¦‚æœè¾“å…¥ä¸ºç©ºåˆ™ä¸åšä»»ä½•äº‹

  // æ›´æ–°èŠå¤©è®°å½•å’ŒèŠå¤©æ¡†
  chatHistory.push({ role: 'user', content: message });
  updateChatBox('user', message);
  localStorage.setItem('chatHistory', JSON.stringify(chatHistory)); // åŒæ­¥åˆ°localStorage

  // å‡†å¤‡è¯·æ±‚æ•°æ®ï¼ŒåŒ…æ‹¬ä¹‹å‰çš„èŠå¤©è®°å½•
  const requestData = {
    messages: chatHistory.concat([{ role: 'system', content: 'You are a helpful assistant.' }])
  };

  const response = await fetch('chat.php', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(requestData),
  });

  const data = await response.json();
  const reply = data.choices[0].message.content;

  // æ›´æ–°èŠå¤©è®°å½•å’ŒèŠå¤©æ¡†
  chatHistory.push({ role: 'assistant', content: reply });
  updateChatBox('gpt', reply);
  localStorage.setItem('chatHistory', JSON.stringify(chatHistory)); // åŒæ­¥åˆ°localStorage
}

function updateChatBox(sender, message) {
  const chatBox = document.getElementById('chat-box');
  const messageElement = document.createElement('div');
  messageElement.textContent = `${sender === 'user' ? 'ğŸ˜Š: ' : 'ğŸ¤–: '}${message}`;
  chatBox.appendChild(messageElement);

  // æ»šåŠ¨åˆ°èŠå¤©æ¡†çš„åº•éƒ¨ï¼Œç¡®ä¿æœ€æ–°æ¶ˆæ¯å¯è§
  chatBox.scrollTop = chatBox.scrollHeight;
}

// åˆ é™¤èŠå¤©è®°å½•çš„é€»è¾‘
document.getElementById('delete-history').addEventListener('click', () => {
  localStorage.removeItem('chatHistory'); // ä»localStorageä¸­åˆ é™¤èŠå¤©è®°å½•
  chatHistory = []; // æ¸…ç©ºå†…å­˜ä¸­çš„èŠå¤©è®°å½•
  document.getElementById('chat-box').innerHTML = ''; // æ¸…ç©ºèŠå¤©æ¡†æ˜¾ç¤º
});
</script>
</body>
</html>
